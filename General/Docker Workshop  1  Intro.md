<ac:layout><ac:layout-section ac:type="single"><ac:layout-cell><h3><em>Copyright (c) 2016 Clarence Bakirtzidis and Kiruthika Samapathy.</em></h3></ac:layout-cell></ac:layout-section><ac:layout-section ac:type="two_equal"><ac:layout-cell><h1>01-Intro</h1><h2>Intro to the Voting App</h2><p>Let's have a look at the voting app that we'll be using during over the course of the tutorial session.</p><p><em>Note: Don't worry too much if you don't understand the commands yet -- we'll cover the details later.</em></p><p>We will use Docker Compose tool to run the app with the&nbsp;<code>docker-compose.yml</code>&nbsp;file -- but we could have used&nbsp;<code>docker run ...</code>&nbsp;commands as well (which we do in&nbsp;<code>exercises/02-basics</code>).</p><p><strong>Start of exercise.</strong></p><div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="kw" style="color: rgb(0,112,32);">cd</span> exercises/01-intro

<span class="kw" style="color: rgb(0,112,32);">eval</span> <span class="ot" style="color: rgb(0,112,32);">$(</span><span class="kw" style="color: rgb(0,112,32);">docker-machine</span> env manager1<span class="ot" style="color: rgb(0,112,32);">)</span>

<span class="kw" style="color: rgb(0,112,32);">docker-compose</span> up -d
<span class="kw" style="color: rgb(0,112,32);">docker-compose</span> ps</code></pre></div><pre><code># Output ==&gt;

Name                    Command               State          Ports
--------------------------------------------------------------------------------
01intro_db_1       /docker-entrypoint.sh postgres   Up      5432/tcp
01intro_redis_1    docker-entrypoint.sh redis ...   Up      6379/tcp
01intro_result_1   node server.js                   Up      0.0.0.0:9001-&gt;80/tcp
01intro_vote_1     gunicorn app:app -b 0.0.0. ...   Up      0.0.0.0:9000-&gt;80/tcp
01intro_worker_1   /bin/sh -c dotnet Worker.dll     Up</code></pre><p>Find IP address of&nbsp;<code>manager1</code>:</p><div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="kw" style="color: rgb(0,112,32);">docker-machine</span> ip manager1

<span class="co" style="color: rgb(96,160,176);"># Output ==&gt; 192.168.99.100</span></code></pre></div><p><em>Note: the IP address may be different on your machine!</em></p><p>Try voting for your favourite domestic animal:</p><ul><li>Open&nbsp;<strong>voting</strong>&nbsp;interface in a browser tab:&nbsp;<a class="uri" href="http://192.168.99.100:9000/">http://192.168.99.100:9000/</a></li><li>Click&nbsp;<strong>Cat</strong>&nbsp;or&nbsp;<strong>Dog</strong></li></ul><p>Check the voting results:</p><ul><li>Open the&nbsp;<strong>results</strong>&nbsp;interface in another tab:&nbsp;<a class="uri" href="http://192.168.99.100:9001/">http://192.168.99.100:9001/</a></li><li>If you change your mind, go back to voting interface and make a different choice</li></ul><p><em>Tip: You can only vote once per browser. To vote more than once, open the voting interface in a&nbsp;<strong>different</strong>&nbsp;browser or open an&nbsp;<strong>incognito</strong>&nbsp;tab.</em></p><p>Stop and remove the application services and custom network when you are done with trying out the voting app:</p><div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="kw" style="color: rgb(0,112,32);">docker-compose</span> down</code></pre></div><p><strong>End of exercise.</strong></p><h2>Homework</h2><p>If this was too easy or you're just curious, have a read of the sections below.</p><h3>Notes</h3><ul><li>All containers are deployed onto a single host (<code>manager1</code>) because we are not using a&nbsp;<em>swarm cluster</em>&nbsp;yet.</li><li>Here we used Docker Compose but it does not (yet) work with the new Docker engine swarm-mode; however, it does work with the legacy Docker Swarm.</li></ul><h3>Questions</h3><ul><li>How can the&nbsp;<code>worker</code>&nbsp;service find the&nbsp;<code>redis</code>&nbsp;and&nbsp;<code>db</code>&nbsp;services and how can the&nbsp;<code>result</code>&nbsp;app find the&nbsp;<code>db</code>&nbsp;service?</li><li><strong>Note:</strong>&nbsp;We are not using links or registering our services explicitly in an external DNS server.</li><li>Try:&nbsp;<code>docker network inspect 01intro_default</code>&nbsp;to see containers connected to our network</li><li>Try:&nbsp;<code>docker-compose exec worker ping -c 1 redis</code>&nbsp;to ping&nbsp;<code>redis</code>&nbsp;from&nbsp;<code>worker</code></li><li>How is using Docker Compose useful for development?</li><li>How can we view the services logs?</li></ul><h3>References</h3><ul><li>Original Instavote app:&nbsp;<a class="uri" href="https://github.com/docker/example-voting-app">https://github.com/docker/example-voting-app</a></li><li>Postgresl image:&nbsp;<a class="uri" href="https://hub.docker.com/_/postgres/">https://hub.docker.com/_/postgres/</a></li><li>Redis image:&nbsp;<a class="uri" href="https://hub.docker.com/_/redis/">https://hub.docker.com/_/redis/</a></li><li>Docker Compose:&nbsp;<a class="uri" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></li><li>Compose file reference:&nbsp;<a class="uri" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></li></ul><p>&nbsp;</p></ac:layout-cell><ac:layout-cell><h1>Docker-compose.yml</h1><p>&nbsp;</p><p>version: &quot;2&quot;</p><p># Docker Tutorial app<br># Based on the Instavote app at: <a href="https://github.com/docker/example-voting-app">https://github.com/docker/example-voting-app</a></p><p>services:</p><p># Python web-based voting app interface.<br> # Accessible at: http:&lt;ip_address&gt;:9000/<br> vote:<br> image: registry.local:5000/vote:v1<br> ports:<br> - &quot;9000:80&quot;</p><p># Redis queue to temporarily hold voting for processing by worker.<br> redis:<br> image: registry.local:5000/redis:alpine</p><p># Worker (C# .NET) service that pull queued votes form redis to process and<br> # store in database.<br> worker:<br> image: registry.local:5000/worker:v1</p><p># Postgresql DB that holds processed votes.<br> db:<br> image: registry.local:5000/postgres:9.4</p><p># Node.JS web-based result intterface that querying state from the database.<br> result:<br> image: registry.local:5000/result:v1<br> ports:<br> - &quot;9001:80&quot;</p></ac:layout-cell></ac:layout-section></ac:layout>