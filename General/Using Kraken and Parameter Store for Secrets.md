

<ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="da58de24-5b46-4dcb-8980-9e45c87c79bf"><ac:parameter ac:name="borderColor">black</ac:parameter><ac:parameter ac:name="titleBGColor">#57D9A3</ac:parameter><ac:parameter ac:name="borderStyle">solid</ac:parameter><ac:parameter ac:name="title">Overview</ac:parameter><ac:rich-text-body><p>When deploying services to AWS Elastic Container Service(ECS) it is necessary to store and encrypt sensitive information such as keys, tokens or passwords. There are several methods for passing environment variables to a container to use with our current deployment process:</p><p><br></p><ol><li><p class="auto-cursor-target"><strong>Set environment variables manually in the Task Definition JSON file</strong></p><ac:structured-macro ac:name="info" ac:schema-version="1" ac:macro-id="6b3485a3-67cf-4400-a67f-820ed48481b4"><ac:rich-text-body><p>This is OK for things like the ASPNETCORE_ENVIRONMENT, or other non-sensitive configuration data</p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></li><li><p class="auto-cursor-target"><strong>Using stream editor, let HAL replace values in the Task Definition JSON file with encrypted values stored for that application</strong></p><ac:structured-macro ac:name="info" ac:schema-version="1" ac:macro-id="1bb7a4de-1e28-4231-a124-2f9d16f1489c"><ac:rich-text-body><p>This isn't advisable due to environment variables appearing in plaintext if you were to view that container service in the AWS console</p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></li><li><p class="auto-cursor-target"><strong>Using AWS Parameter Store to manually set encrypted values and reference those values in the Task Definition JSON file. These will be decrypted and set at container run time</strong></p><ac:structured-macro ac:name="info" ac:schema-version="1" ac:macro-id="8929af2e-3b3a-49dc-8246-12a981c2ae4c"><ac:rich-text-body><p>This will work, but setting values manually leads to errors and maintenance overhead if anything should need to change in the future</p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></li><li><p class="auto-cursor-target"><strong>Using AWS Secrets Manager to manually set encrypted values and reference those values in the Task Definition JSON file. These will be decrypted and set at container run time</strong></p><ac:structured-macro ac:name="info" ac:schema-version="1" ac:macro-id="2dc06dd8-78fb-4c8c-af32-be3d343f363d"><ac:rich-text-body><p>Same issue as above, but another added aspect of that Secrets Manager is a paid for service as well</p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></li><li><strong>Using Parameter Store, along with Kraken (Subset application of HAL) to manage secrets and reference those values in the Task Definition JSON file. These will be decrypted and set at container run time</strong></li></ol><p><br></p><p>This confluence documentation will be talking about how to setup option 5 in particular.</p></ac:rich-text-body></ac:structured-macro>

<ac:structured-macro ac:name="expand" ac:schema-version="1" ac:macro-id="91201c23-459d-41bb-886c-7a71eb287c67"><ac:parameter ac:name="title">Managing Secrets using Kraken</ac:parameter><ac:rich-text-body><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="ce6f5272-82a3-4be3-b80e-5148a6d5f9cf"><ac:parameter ac:name="borderColor">black</ac:parameter><ac:parameter ac:name="titleBGColor">#79E2F2</ac:parameter><ac:parameter ac:name="borderStyle">solid</ac:parameter><ac:parameter ac:name="title">Managing Secrets using Kraken</ac:parameter><ac:rich-text-body><p>Setup:</p><ul><li>Services have been configured in HAL and have build definitions</li><li>Secrets to store have been documented in Secret Server</li><li>Ownership of HAL application (whoever set it up)</li></ul><p>Steps:</p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="040341c9-052a-4ae2-984a-c752be5586ac"><ac:parameter ac:name="title">1. Navigate to your application in HAL</ac:parameter><ac:rich-text-body><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-20-54.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="29c07934-5f39-416e-afbf-a2e0b9b8696a"><ac:parameter ac:name="title">2. Scroll to bottom of application page and select &quot;Learn about Runtime Configuration&quot;</ac:parameter><ac:rich-text-body><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-22-18.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="02d82358-1f67-4e55-84ab-16637746bb3c"><ac:parameter ac:name="title">3. Fill out core ID and enable Kraken. Enable Environment.</ac:parameter><ac:rich-text-body><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-23-12.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-24-41.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="e7db8f74-5e01-44a1-9ada-ae268f17c59b"><ac:parameter ac:name="title">4. Select &quot;test-aws&quot;, &quot;beta-aws&quot; or &quot;prod-aws&quot; and fill out other information. Enable AWS SSM Parameter Store.</ac:parameter><ac:rich-text-body><p>QKS is not required for storing to SSM. Leave the SSM Encryption Key as default (blank).</p><p><ac:image><ri:attachment ri:filename="image2019-2-1_8-16-10.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="84c17fc9-857f-4323-8b9b-cf7f3cd38b70"><ac:parameter ac:name="title">5. Add/Remove Schema. Add property to schema.</ac:parameter><ac:rich-text-body><p><ac:image ac:height="250"><ri:attachment ri:filename="image2019-2-1_8-20-9.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2019-2-1_8-20-57.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p>Please mark secrets as &quot;secure&quot;.</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-29-40.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="a229bf6e-c446-424c-b8ab-58cfe0ad1cd4"><ac:parameter ac:name="title">6. Edit property for particular environment</ac:parameter><ac:rich-text-body><p><ac:image ac:height="250"><ri:attachment ri:filename="image2019-2-1_8-23-22.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p>Edit Configuration ^</p><p><ac:image ac:height="183"><ri:attachment ri:filename="image2019-1-29_14-32-1.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-2-1_8-24-0.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="16b37f44-6fdb-470e-a1b3-9b11aecf4cab"><ac:parameter ac:name="title">7. Release the Kraken</ac:parameter><ac:rich-text-body><p><ac:image ac:height="250"><ri:attachment ri:filename="image2019-2-1_8-24-27.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-33-28.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="2ad01c73-b91a-4c1c-8abc-6ec0a71b8c4a"><ac:parameter ac:name="title">8. Verify parameters are stored</ac:parameter><ac:rich-text-body><p>In AWS Console navigate to Systems Manager/Parameter Store</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-35-20.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image><ac:image ac:height="400"><ri:attachment ri:filename="image2019-1-29_14-35-56.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p><ac:image ac:height="152"><ri:attachment ri:filename="image2019-1-29_14-36-29.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></ac:rich-text-body></ac:structured-macro>

<ac:structured-macro ac:name="expand" ac:schema-version="1" ac:macro-id="d12da634-ff58-466e-866e-2d7935ed2989"><ac:parameter ac:name="title">Using Secrets in your ECS instances</ac:parameter><ac:rich-text-body><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="979ac647-41a3-4968-8499-988d92006c51"><ac:parameter ac:name="borderColor">Black</ac:parameter><ac:parameter ac:name="titleBGColor">#FFC400</ac:parameter><ac:parameter ac:name="borderStyle">solid</ac:parameter><ac:parameter ac:name="title">Using Secrets in your ECS instances</ac:parameter><ac:rich-text-body><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="b85c5796-073d-4625-9054-4bab522eb876"><ac:parameter ac:name="title">1. Define secret to use in your task JSON file</ac:parameter><ac:rich-text-body><p><ac:image ac:height="164"><ri:attachment ri:filename="image2019-1-29_15-42-29.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p><p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/specifying-sensitive-data.html">https://docs.aws.amazon.com/AmazonECS/latest/developerguide/specifying-sensitive-data.html</a></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="4738938d-44f6-4018-bc21-92bace0a7062"><ac:parameter ac:name="title">2. Define execution role to use parameter store values</ac:parameter><ac:rich-text-body><p><ac:image ac:height="217"><ri:attachment ri:filename="image2019-1-29_15-43-20.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="87d4ce9a-195c-4a6f-9fc2-d95efaa22e7a"><ac:parameter ac:name="title">3. Update awscli for HAL</ac:parameter><ac:rich-text-body><p>Add:</p><p><em>pip install awscli --upgrade</em></p><p>to your HAL9000 yaml file or script.</p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p><ac:structured-macro ac:name="panel" ac:schema-version="1" ac:macro-id="c7ac1649-7f65-4234-a35c-a19d91cc1c02"><ac:parameter ac:name="title">4. Use secret in container</ac:parameter><ac:rich-text-body><p><ac:image ac:height="114"><ri:attachment ri:filename="image2019-1-29_15-44-11.png"><ri:page ri:space-key="~pvarga" ri:content-title="Using Kraken and Parameter Store for Secrets"></ri:page></ri:attachment></ac:image></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></ac:rich-text-body></ac:structured-macro><p class="auto-cursor-target"><br></p></ac:rich-text-body></ac:structured-macro>



