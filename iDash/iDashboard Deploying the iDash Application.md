<ac:layout><ac:layout-section ac:type="single"><ac:layout-cell><p>This space is dedicated to documenting all of the infrastructure and configuration in deploying the iDash application.</p></ac:layout-cell></ac:layout-section><ac:layout-section ac:type="single"><ac:layout-cell><p>&nbsp;</p></ac:layout-cell></ac:layout-section><ac:layout-section ac:type="single"><ac:layout-cell><h1>Coding</h1><p>The code is written as an MVC application using DotNetCore in VS 2017. The source control repository is housed within Git here: <a href="https://git/pvarga/iDash">https://git/pvarga/iDash</a></p><p class="p1"><strong><br></strong></p><p class="p1"><strong>MVC: Model-View-Controller</strong></p><p class="p2">The Model-View-Controller (MVC) architectural pattern separates an app into three main components: <strong>M</strong>odel, <strong>V</strong>iew, and <strong>C</strong>ontroller. The MVC pattern helps us to create apps that are more testable and easier to update than traditional monolithic apps. MVC-based apps contain:</p><ul class="ul1"><li class="li3"><strong>M</strong>odels: Classes that represent the data of the app. The model classes use validation logic to enforce business rules for that data. Typically, model objects retrieve and store model state in a database.</li><li class="li3"><span class="s1">&nbsp;</span><strong>V</strong>iews: Views are the components that display the app's user interface (UI). Generally, this UI displays the model data.</li><li class="li3"><span class="s1">&nbsp;</span><strong>C</strong>ontrollers: Classes that handle browser requests. They retrieve model data and call view templates that return a response. In an MVC app, the view only displays information; the controller handles and responds to user input and interaction.</li></ul><p class="li3">&nbsp;</p><h1>Building</h1><p>We have created an auto-polling (every 60s) Continuous Integration trigger using vNext builds within TFS. We build, copy the artifacts to the build server, and then publish the application files.</p><p>Then we push the published file to a TFS Artifact (server).</p><p><a href="http://tfs/tfs/QL/IT/_apps/hub/ms.vss-ciworkflow.build-ci-hub?_a=edit-build-definition&amp;id=2448">http://tfs/tfs/QL/IT/_apps/hub/ms.vss-ciworkflow.build-ci-hub?_a=edit-build-definition&amp;id=2448</a></p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2018-1-18 12:25:0.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>&nbsp;</p><h1>Deploying (Release)</h1><p>We then auto-release the published application files from the build artifact on the build server, (from the build phase). We copy the published output files (artifact) to the BulletTime server: <strong>QL1BTimeWebDev1</strong>. We publish from the build/local server directory: iDashNet\bin\Release\netcoreapp1.1\Publish</p><p><a href="http://tfs/tfs/QL/IT/_release?definitionId=4&amp;_a=releases">http://tfs/tfs/QL/IT/_release?definitionId=4&amp;_a=releases</a></p><p>We created a pipeline in TFS to take the build artifact on the server, and copy it to the BulletTime server:</p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2018-1-18 12:27:35.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>During the release phase, we Stop the AppPool for iDash, forcing a stop after 45s, copy the artifact from :&nbsp;$(System.DefaultWorkingDirectory)/iDash/drop to the target folder on the BulletTime server, in the folder:&nbsp;&nbsp;C:\sites\iDash</p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2018-1-18 12:28:2.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2018-1-18 12:30:27.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>... and then restart the AppPool</p><p>&nbsp;</p><p>The published files are copied to <strong>QL1BTimeWebDev1</strong> in the folder: C:\sites\iDash</p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2017-6-20 11:57:12.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><h1>Hosting</h1><p>On&nbsp;<strong>QL1BTimeWebDev1</strong> we then host the application using IIS.&nbsp;</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2017-6-20 11:58:8.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>&nbsp;</p><p>We then opened a firewall on port: 5000&nbsp;</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2017-6-20 11:58:37.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>&nbsp;</p><p>We then tested it locally on <strong>QL1BTimeWebDev1</strong>&nbsp;- seeing the deployed application, live in action:</p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2017-6-20 11:59:11.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>&nbsp;</p><p>We then tested navigating to the deployed application from a web browser:&nbsp;<a href="http://ql1btimewebdev1:5000/">http://ql1btimewebdev1:5000/</a></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2017-6-20 12:0:17.png"><ri:page ri:space-key="~pvarga" ri:content-title="iDashboard: Deploying the iDash Application"></ri:page></ri:attachment></ac:image></p><p>&nbsp;</p><p>Everything works, and we now have a continuous deployment pipeline &ndash;&nbsp;for any code checked in, we auto-build and auto-deploy! Enjoy!</p><p>&nbsp;</p><p>Note: Sometimes, the &quot;Release&quot; deployment pipeline in TFS has errors/fails, and you'll need to copy the files manually:</p><ul><li class="p1">iDash &gt; Copy to Server manually:&nbsp;</li><li class="p1">Log into <strong>QL1BTIMEWEBDEV1</strong> (you'll probably need to jumpbox into this machine, from <strong>UTILITYBOX</strong> first)</li><li class="p3"><span class="s1">Copy from : <span class="s2"><a href="smb://qlntaprmfs1/rm_dmz$/Drop/iDash">\\qlntaprmfs1\rm_dmz$\Drop\iDash</a>&nbsp;(pick the latest deployed to folder)</span></span></li><li class="p1">&hellip;Into the iDash directory: <strong>C:\Sites\iDash</strong></li><li class="p3"><span class="s1">Copy all files in the deployed folder and replace all into the &quot;Sites\iDash&quot; server folder</span></li></ul></ac:layout-cell></ac:layout-section></ac:layout>